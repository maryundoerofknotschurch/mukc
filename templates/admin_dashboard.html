<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        h2 {
            margin-top: 40px;
        }
        table {
            margin-bottom: 50px;
        }
    </style>
</head>
<body>
<!-- HEADER (copied from home page navbar) -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary header">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Mary Undoer of Knots Church</a>
    </div>
</nav>
<br><br>
    <div class="container">
        <!-- BACK BUTTON -->
        <a href="/" class="btn btn-secondary back-btn">‚Üê Back to Home</a>

        <h1 class="mb-4">Dashboard</h1>

        <div class="alert alert-info">
            <strong>Total Visitors:</strong> {{ total_visits }}
        </div>
        <h5>Daily Visitor Details</h5>

        <table class="table table-bordered table-sm" id="visitorTable">
        <thead class="table-light">
            <tr>
                <th>Date</th>
                <th>IP Address</th>
                <th>Hits</th>
            </tr>
        </thead>
    
        <tbody id="visitorTableBody">
            {% for row in daily_visits %}
            <tr>
                <td>{{ row.date }}</td>
                <td>{{ row.ip }}</td>
                <td>{{ row.count }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3" class="text-center text-muted">
                    No visitor data
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

        <div class="d-flex justify-content-center">
            <nav>
                <ul class="pagination pagination-sm" id="visitorPagination"></ul>
            </nav>
        </div>




        <!-- Contact Submissions Table -->
        <h2>Contact Submissions</h2>
        {% if contact_data %}
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        {% for header in contact_headers %}
                        <th>{{ header }}</th>
                        {% endfor %}
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in contact_data %}
                    <tr>
                        {% for header in contact_headers %}
                        <td>{{ row[header] }}</td>
                        {% endfor %}
                        <td>
                            <a href="{{ url_for('delete_contact', index=loop.index0) }}" class="btn btn-danger btn-sm">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No contact submissions found.</p>
        {% endif %}

        <!-- Donation Submissions Table -->
        <h2>Donations</h2>
        {% if donate_data %}
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        {% for header in donate_headers %}
                        <th>{{ header }}</th>
                        {% endfor %}
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in donate_data %}
                    <tr>
                        {% for header in donate_headers %}
                        <td>{{ row[header] }}</td>
                        {% endfor %}
                        <td>
                            <a href="{{ url_for('delete_donate', index=loop.index0) }}" class="btn btn-danger btn-sm">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No donations found.</p>
        {% endif %}
    </div>
</body>
<script>
document.addEventListener("DOMContentLoaded", function () {

    const rowsPerPage = 10;
    const pageBlockSize = 10;      // show only 10 page numbers

    const tbody = document.getElementById("visitorTableBody");
    const rows = Array.from(tbody.querySelectorAll("tr"));
    const pagination = document.getElementById("visitorPagination");

    if (!tbody || rows.length === 0) return;

    let currentPage = 1;
    const totalPages = Math.ceil(rows.length / rowsPerPage);

    function showPage(page) {
        if (page < 1 || page > totalPages) return;
        currentPage = page;

        rows.forEach((row, index) => {
            row.style.display =
                index >= (page - 1) * rowsPerPage &&
                index < page * rowsPerPage ? "" : "none";
        });

        renderPagination();
    }

    function renderPagination() {
        pagination.innerHTML = "";

        const blockStart = Math.floor((currentPage - 1) / pageBlockSize) * pageBlockSize + 1;
        const blockEnd = Math.min(blockStart + pageBlockSize - 1, totalPages);

        // Previous
        const prev = document.createElement("li");
        prev.className = "page-item" + (currentPage === 1 ? " disabled" : "");
        prev.innerHTML = `<a class="page-link" href="#">Previous</a>`;
        prev.onclick = () => showPage(currentPage - 1);
        pagination.appendChild(prev);

        // Page numbers (10 only)
        for (let i = blockStart; i <= blockEnd; i++) {
            const li = document.createElement("li");
            li.className = "page-item" + (i === currentPage ? " active" : "");
            li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
            li.onclick = () => showPage(i);
            pagination.appendChild(li);
        }

        // Next
        const next = document.createElement("li");
        next.className = "page-item" + (currentPage === totalPages ? " disabled" : "");
        next.innerHTML = `<a class="page-link" href="#">Next</a>`;
        next.onclick = () => showPage(currentPage + 1);
        pagination.appendChild(next);
    }

    showPage(1);
});
</script>


</html>
